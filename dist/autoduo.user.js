var AutoDuo=function(e){"use strict";const t={delays:{betweenActions:300,afterSolve:500,waitForElement:5e3,pollInterval:100},debug:!1,autoSubmit:!1,version:"1.0.0"};let n=null;function o(e){n=e}function r(e,o,...r){if("debug"===e&&!t.debug)return;const i=`${o}${r.length>0?" "+r.map(e=>"object"==typeof e?JSON.stringify(e):String(e)).join(" "):""}`;n&&n.log(i,e)}const i={debug:(e,...t)=>r("debug",e,...t),info:(e,...t)=>r("info",e,...t),warn:(e,...t)=>r("warn",e,...t),error:(e,...t)=>r("error",e,...t),setLogPanel:o},s=i.info,l=i.debug,a=i.warn,c=i.error;class u{container=null;content=null;maxLines=100;isVisible=!0;logs=[];show(){this.container||(this.container=document.createElement("div"),this.container.id="autoduo-log-panel",this.container.innerHTML=`\n            <div style="\n                position: fixed;\n                top: 10px;\n                left: 10px;\n                width: 450px;\n                max-height: 350px;\n                background: rgba(0, 0, 0, 0.9);\n                border: 1px solid #333;\n                border-radius: 8px;\n                font-family: monospace;\n                font-size: 11px;\n                color: #fff;\n                z-index: 99999;\n                overflow: hidden;\n            ">\n                <div style="\n                    padding: 8px 12px;\n                    background: #1a1a2e;\n                    border-bottom: 1px solid #333;\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                ">\n                    <span style="font-weight: bold; color: #58cc02;">\n                        AutoDuo ${t.version}\n                    </span>\n                    <div style="display: flex; gap: 8px;">\n                        <button id="autoduo-log-copy" style="\n                            background: #333;\n                            border: none;\n                            color: #888;\n                            cursor: pointer;\n                            font-size: 11px;\n                            padding: 2px 8px;\n                            border-radius: 4px;\n                        ">Copy</button>\n                        <button id="autoduo-log-clear" style="\n                            background: #333;\n                            border: none;\n                            color: #888;\n                            cursor: pointer;\n                            font-size: 11px;\n                            padding: 2px 8px;\n                            border-radius: 4px;\n                        ">Clear</button>\n                        <button id="autoduo-log-toggle" style="\n                            background: none;\n                            border: none;\n                            color: #888;\n                            cursor: pointer;\n                            font-size: 14px;\n                        ">−</button>\n                    </div>\n                </div>\n                <div id="autoduo-log-content" style="\n                    padding: 8px;\n                    max-height: 290px;\n                    overflow-y: auto;\n                "></div>\n            </div>\n        `,document.body.appendChild(this.container),this.content=document.getElementById("autoduo-log-content"),document.getElementById("autoduo-log-toggle")?.addEventListener("click",()=>this.toggle()),document.getElementById("autoduo-log-copy")?.addEventListener("click",()=>this.copyToClipboard()),document.getElementById("autoduo-log-clear")?.addEventListener("click",()=>this.clear()))}hide(){this.container&&(this.container.remove(),this.container=null,this.content=null)}toggle(){if(!this.content)return;this.isVisible=!this.isVisible,this.content.style.display=this.isVisible?"block":"none";const e=document.getElementById("autoduo-log-toggle");e&&(e.textContent=this.isVisible?"−":"+")}copyToClipboard(){const e=this.logs.join("\n");navigator.clipboard.writeText(e).then(()=>{const e=document.getElementById("autoduo-log-copy");e&&(e.textContent="Copied!",setTimeout(()=>{e.textContent="Copy"},1500))})}log(e,t="info"){const n=`[${(new Date).toLocaleTimeString()}] ${e}`;if(this.logs.push(n),this.logs.length>this.maxLines&&this.logs.shift(),!this.content)return;const o=document.createElement("div");for(o.style.color={info:"#fff",warn:"#ffc107",error:"#dc3545",debug:"#6c757d"}[t]??"#fff",o.style.marginBottom="2px",o.style.wordBreak="break-word",o.textContent=n,this.content.appendChild(o);this.content.children.length>this.maxLines;)this.content.firstChild?.remove();this.content.scrollTop=this.content.scrollHeight}clear(){this.logs=[],this.content&&(this.content.innerHTML="")}}let d=null;function h(){return d||(d=new u),d}function f(e){const t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(t)}function g(){const e=['[data-test="player-next"]','button[data-test="player-next"]'];for(const t of e){const e=document.querySelector(t);if(e){if(!(e.disabled||"true"===e.getAttribute("aria-disabled")))return f(e),!0}}return!1}function p(e){return new Promise(t=>setTimeout(t,e))}const m={MATH_CHALLENGE_BLOB:'[data-test="challenge challenge-mathChallengeBlob"]',CHALLENGE_CONTAINER:'[data-test^="challenge challenge-"]',CHALLENGE_HEADER:'[data-test="challenge-header"]',PATTERN_TABLE:'[data-test="challenge-patternTable"]',CHALLENGE_CHOICE:'[data-test="challenge-choice"]',CHALLENGE_TAP_TOKEN:'[data-test="challenge-tap-token"], [data-test="-challenge-tap-token"]',TEXT_INPUT:'[data-test="challenge-text-input"]',EQUATION_CONTAINER:"._1KXkZ",PLAYER_NEXT:'[data-test="player-next"]',PLAYER_SKIP:'[data-test="player-skip"]',PRACTICE_AGAIN:'[data-test="practice-again-button"]',BLAME_INCORRECT:'[data-test="blame blame-incorrect"]',SESSION_COMPLETE:'[data-test="session-complete-slide"]',KATEX:".katex",ANNOTATION:"annotation",MATH_IFRAME:'iframe[title="Math Web Element"]',SANDBOX_IFRAME:"iframe[sandbox][srcdoc]"};function b(e){const t=e.querySelectorAll(m.MATH_IFRAME),n=e.querySelectorAll(m.SANDBOX_IFRAME),o=new Set([...t,...n]);return Array.from(o)}function x(e,t){for(const n of e){const e=n.getAttribute("srcdoc");if(e?.includes(t))return n}return null}function v(){const e=document.querySelector(m.MATH_CHALLENGE_BLOB);if(e)return i.debug("detectChallenge: found mathChallengeBlob"),y(e);const t=document.querySelector(m.CHALLENGE_CONTAINER);if(t)return i.debug("detectChallenge: found challenge container"),y(t);const n=document.querySelector(m.CHALLENGE_HEADER);if(n){return y(n.closest("[data-test]")??document.body)}return i.debug("detectChallenge: no challenge container found"),null}function y(e){const t=e.querySelector(m.CHALLENGE_HEADER),n=e.querySelector(m.EQUATION_CONTAINER),o=e.querySelector(m.TEXT_INPUT),r=Array.from(e.querySelectorAll(m.CHALLENGE_CHOICE)),s=Array.from(e.querySelectorAll(m.CHALLENGE_TAP_TOKEN)),l=e.querySelector(m.MATH_IFRAME),a=r.length>0?r:s,c={container:e,header:t,headerText:t?.textContent?.toLowerCase()??"",equationContainer:n,textInput:o,choices:a.length>0?a:[],iframe:l};return i.debug("createChallengeContext:",{hasHeader:!!t,hasEquation:!!n,hasInput:!!o,choicesCount:a.length,hasIframe:!!l}),c}function k(){return null!==document.querySelector(m.SESSION_COMPLETE)}function S(){return null!==document.querySelector(m.BLAME_INCORRECT)}function C(){const e=window.location.href;return e.includes("/learn")&&!e.includes("/lesson")&&!e.includes("/practice")}function E(){return null!==document.querySelector('[data-test*="skill-path-level"] button:not([disabled])')}function w(){const e=document.querySelector("._36bu_");if(e){const t=e.closest('[role="button"]');if(t)return i.info("clicking START lesson"),t.dispatchEvent(new MouseEvent("click",{bubbles:!0})),setTimeout(()=>{const e=document.querySelector('button[data-test="start-button"], a[href*="/lesson"]');e&&e.click()},300),!0}const t=document.querySelectorAll('[data-test*="skill-path-level"] button:not([disabled])');for(const e of t){if(!(null!==e.querySelector('svg path[d*="M34.2346"]')))return i.info("clicking next available lesson"),e.dispatchEvent(new MouseEvent("click",{bubbles:!0})),setTimeout(()=>{const e=document.querySelector('button[data-test="start-button"], a[href*="/lesson"]');e&&e.click()},300),!0}return i.warn("no available lessons found"),!1}var T=Object.freeze({__proto__:null,clickNextLesson:w,detectChallenge:v,hasNextLesson:E,isIncorrect:S,isOnHomePage:C,isOnResultScreen:k});class A{log(...e){i.info(`[${this.name}]`,...e)}logDebug(...e){i.debug(`[${this.name}]`,...e)}logError(...e){i.error(`[${this.name}]`,...e)}success(e){return{...e,success:!0}}failure(e,t){return this.logError(t),{type:e,success:!1,error:t}}click(e){const t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(t)}typeInput(e,t){const n=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value")?.set;n?n.call(e,t):e.value=t;const o=new Event("input",{bubbles:!0});e.dispatchEvent(o)}getHeaderText(e){return e.headerText?e.headerText.toLowerCase():e.header?.textContent?e.header.textContent.toLowerCase():""}headerContains(e,...t){const n=this.getHeaderText(e);return t.every(e=>n.includes(e.toLowerCase()))}}function q(e,t){if(t<=0)throw new Error("Base must be positive");return Math.round(e/t)*t}function I(e){const t=e.toLowerCase().match(/nearest\s*(\d+)/);if(t?.[1]){const e=parseInt(t[1],10);return Number.isNaN(e)?null:e}return null}function V(e){if(!e)return null;const t=function(e){const t=e.match(/<span class="dark-img">([\s\S]*?)<\/span>/);if(t?.[1])return i.debug("extractBlockDiagramValue: using dark-img SVG"),t[1];const n=e.match(/<span class="light-img">([\s\S]*?)<\/span>/);return n?.[1]?(i.debug("extractBlockDiagramValue: using light-img SVG"),n[1]):e}(e),n=function(e){const t=e.match(/<path[^>]*>/gi)??[];let n=0;for(const e of t){const t=/clip-rule=["']evenodd["']/i.test(e),o=/fill=["']#(?:1CB0F6|49C0F8)["']/i.test(e);t&&o&&(n+=100)}return n}(t);n>0&&i.debug("extractBlockDiagramValue: found hundred-block structures =",n);const o=function(e){let t=0;const n=e.match(/<rect[^>]*fill=["']#(?:1CB0F6|49C0F8)["'][^>]*>/gi);n&&(t+=n.length);const o=e.match(/<path[^>]*>/gi)??[];for(const e of o){const n=/clip-rule=["']evenodd["']/i.test(e),o=/fill=["']#(?:1CB0F6|49C0F8)["']/i.test(e);!n&&o&&t++}return t}(t);if(o>0){const e=o+n;return i.debug("extractBlockDiagramValue: regular =",o,"+ hundreds =",n,"=",e),e}const r=t.match(/<rect[^>]*height=["']14\.1(?:755|323)["'][^>]*>/gi);if(r&&r.length>0){const e=Math.round(r.length/8),t=10*e+n;return i.debug("extractBlockDiagramValue: columns =",e,"+ hundreds =",n,"=",t),t}return n>0?n:(i.debug("extractBlockDiagramValue: no blocks found"),null)}function N(e){if(!e)return!1;const t=/#(?:1CB0F6|49C0F8)/i.test(e),n=/<rect[^>]*>/i.test(e);return t&&n}function B(e,t){const n=e.indexOf(t);if(-1===n)return e;const o=e.indexOf("{",n+t.length);if(-1===o)return e;let r=1,i=o+1;for(;r>0&&i<e.length;)"{"===e[i]?r++:"}"===e[i]&&r--,i++;const s=e.substring(o+1,i-1);return e.substring(0,n)+s+e.substring(i)}function F(e){let t=e;const n=["\\mathbf","\\textbf","\\text","\\mbox"];for(const e of n)for(;t.includes(e+"{");)t=B(t,e);return t}function O(e){return e.replace(/\\cdot/g,"*").replace(/\\times/g,"*").replace(/\\div/g,"/").replace(/\\pm/g,"±").replace(/×/g,"*").replace(/÷/g,"/").replace(/−/g,"-").replace(/⋅/g,"*")}function R(e){let t=e;for(;t.includes("\\frac{");){const e=t.match(/\\frac\{/);if(void 0===e?.index)break;const n=e.index,o=n+6;let r=1,i=o;for(;r>0&&i<t.length;)"{"===t[i]?r++:"}"===t[i]&&r--,i++;const s=t.substring(o,i-1),l=i+1;r=1;let a=l;for(;r>0&&a<t.length;)"{"===t[a]?r++:"}"===t[a]&&r--,a++;const c="("+s+"/"+t.substring(l,a-1)+")";t=t.substring(0,n)+c+t.substring(a)}return t}function L(e){let t=e;return t=F(t),t=O(t),t=R(t),t=t.replace(/\s+/g,""),i.debug("cleanLatexForEval:",e,"->",t),t}function M(e){if(!e)return i.debug("extractKatexValue: element is null"),null;i.debug("extractKatexValue: processing element");const t=e.querySelector("annotation");if(t?.textContent){let e=t.textContent;return i.debug("extractKatexValue: found annotation",e),e=F(e),e=O(e),e=R(e),e=e.replace(/\s+/g,""),i.debug("extractKatexValue: cleaned annotation value",e),e}const n=e.querySelector(".katex-html");if(n?.textContent){const e=n.textContent.trim();return i.debug("extractKatexValue: found katex-html text",e),e}const o=e.textContent?.trim()??null;return i.debug("extractKatexValue: fallback to textContent",o),o}function D(e){let t=e;return t=F(t),t=t.replace(/\\htmlClass\{[^}]*\}\{([^}]+)\}/g,"$1"),t.trim()}class P extends A{name="RoundToNearestSolver";canSolve(e){return this.headerContains(e,"round","nearest")}solve(e){this.log("starting");const t=I(this.getHeaderText(e));if(!t)return this.failure("roundToNearest","could not extract rounding base from header");this.log("rounding base =",t);const n=this.extractNumberToRound(e);if(null===n)return this.failure("roundToNearest","could not extract number to round");const o=q(n,t);return this.log(n,"rounds to",o),e.textInput?this.solveWithTextInput(e.textInput,n,t,o):e.choices&&e.choices.length>0?this.solveWithChoices(e.choices,n,t,o):this.failure("roundToNearest","no text input or choices found")}extractNumberToRound(e){if(!e.equationContainer)return this.logError("equationContainer is null"),null;const t=e.equationContainer.querySelector("annotation");if(!t?.textContent)return this.logError("annotation not found"),null;const n=D(t.textContent),o=parseInt(n,10);return Number.isNaN(o)?(this.logError("could not parse number from:",n),null):(this.log("number to round =",o),o)}solveWithTextInput(e,t,n,o){return this.typeInput(e,o.toString()),this.log("typed answer:",o),this.success({type:"roundToNearest",numberToRound:t,roundingBase:n,roundedValue:o,answer:o})}solveWithChoices(e,t,n,o){let r=-1;for(let t=0;t<e.length;t++){const n=e[t];if(!n)continue;const i=this.getBlockDiagramValue(n);if(null!==i){if(this.logDebug("choice",t,"has",i,"blocks"),i===o){r=t,this.log("found matching choice",t,"with",i,"blocks");break}continue}const s=this.getKatexValue(n);if(null!==s&&(this.logDebug("choice",t,"KaTeX value =",s),s===o)){r=t,this.log("found matching choice",t,"with KaTeX value",s);break}}if(-1===r)return this.failure("roundToNearest",`no matching choice found for rounded value ${o}`);const i=e[r];return i&&(this.click(i),this.log("clicked choice",r)),this.success({type:"roundToNearest",numberToRound:t,roundingBase:n,roundedValue:o,selectedChoice:r})}getBlockDiagramValue(e){const t=e.querySelector('iframe[title="Math Web Element"]');if(!t)return null;const n=t.getAttribute("srcdoc");return n?V(n):null}getKatexValue(e){const t=e.querySelector("annotation");if(!t?.textContent)return null;const n=D(t.textContent),o=parseInt(n,10);return Number.isNaN(o)?null:o}}function $(e,t){for(e=Math.abs(e),t=Math.abs(t);0!==t;){const n=t;t=e%t,e=n}return e}function _(e,t){return Math.abs(e*t)/$(e,t)}function X(e,t){if(0===t)throw new Error("Denominator cannot be zero");const n=$(e,t);let o=e/n,r=t/n;return r<0&&(o=-o,r=-r),{numerator:o,denominator:r}}function H(e,t,n,o){const r=e*o,i=n*t;return r<i?-1:r>i?1:0}function W(e,t,n,o){return 0===H(e,t,n,o)}function U(e,t,n,o){const r=_(t,o);return X(e*(r/t)+n*(r/o),r)}function K(e,t,n,o){return X(e*n,t*o)}function G(e){if(!e)return i.debug("evaluateMathExpression: expression is null/empty"),null;i.debug("evaluateMathExpression: input",e);let t=e.toString().replace(/\s+/g,"");if(t=O(t),t=t.replace(/[^\d+\-*/().]/g,""),i.debug("evaluateMathExpression: cleaned",t),!/^[\d+\-*/().]+$/.test(t))return i.warn("evaluateMathExpression: invalid expression after cleaning",t),null;if(""===t||"()"===t)return null;try{const e=new Function("return "+t)();return"number"==typeof e&&Number.isFinite(e)?(i.debug("evaluateMathExpression: result",e),e):(i.warn("evaluateMathExpression: result is not a valid number",e),null)}catch(e){return i.error("evaluateMathExpression: eval error",e instanceof Error?e.message:String(e)),null}}function z(e){i.debug("parseFractionExpression: input",e);let t=e;for(;t.includes("\\mathbf{");)t=B(t,"\\mathbf");for(;t.includes("\\textbf{");)t=B(t,"\\textbf");i.debug("parseFractionExpression: after removing wrappers:",t);const n=t.match(/^\\frac\{(\d+)\}\{(\d+)\}$/);if(n?.[1]&&n[2]){const e=parseInt(n[1],10),t=parseInt(n[2],10);return{numerator:e,denominator:t,value:e/t}}const o=t.match(/^(\d+)\s*\/\s*(\d+)$/);if(o?.[1]&&o[2]){const e=parseInt(o[1],10),t=parseInt(o[2],10);return{numerator:e,denominator:t,value:e/t}}if(t=R(t),t=t.replace(/\s+/g,""),i.debug("parseFractionExpression: converted expression:",t),t.includes("+")||t.includes("-")){const e=G(t);if(null!==e){const t=[2,3,4,5,6,8,10,12,100];for(const n of t){const t=Math.round(e*n);if(Math.abs(t/n-e)<1e-4)return{numerator:t,denominator:n,value:e}}}}return null}function j(e){i.debug("solveEquationWithBlank: input",e);let t=e.replace(/\\duoblank\{[^}]*\}/g,"X").replace(/\s+/g,"");t=F(t),t=L(t),i.debug("solveEquationWithBlank: cleaned",t);const n=t.split("=");if(2!==n.length||!n[0]||!n[1])return i.debug("solveEquationWithBlank: invalid equation format"),null;const[o,r]=n;if("X"===r&&!o.includes("X")){const e=G(o);if(null!==e)return i.debug("solveEquationWithBlank: X alone on right, result =",e),e}if("X"===o&&!r.includes("X")){const e=G(r);if(null!==e)return i.debug("solveEquationWithBlank: X alone on left, result =",e),e}return o.includes("X")?J(o,r):r.includes("X")?J(r,o):(i.debug("solveEquationWithBlank: X not found"),null)}function J(e,t){const n=G(t);if(null===n)return i.debug("solveForX: could not evaluate other side"),null;const o=function(e,t){const n=[{pattern:/^X$/,solve:()=>t},{pattern:/^X\+(\d+)$/,solve:e=>t-e},{pattern:/^X-(\d+)$/,solve:e=>t+e},{pattern:/^(\d+)\+X$/,solve:e=>t-e},{pattern:/^(\d+)-X$/,solve:e=>e-t},{pattern:/^X\*(\d+)$/,solve:e=>t/e},{pattern:/^(\d+)\*X$/,solve:e=>t/e},{pattern:/^X\/(\d+)$/,solve:e=>t*e},{pattern:/^(\d+)\/X$/,solve:e=>e/t},{pattern:/^\(X\)\+(\d+)$/,solve:e=>t-e},{pattern:/^\(X\)-(\d+)$/,solve:e=>t+e},{pattern:/^\(X\)\*(\d+)$/,solve:e=>t/e},{pattern:/^\(X\)\/(\d+)$/,solve:e=>t*e}];for(const{pattern:t,solve:o}of n){const n=e.match(t);if(n){const e=o(n[1]?parseInt(n[1],10):0);if(Number.isFinite(e))return i.debug("solveForX: algebraic solution X =",e),e}}return null}(e,n);return null!==o?o:function(e,t,n,o){for(let r=n;r<=o;r++){const n=G(e.replace(/X/g,`(${r})`));if(null!==n&&Math.abs(n-t)<1e-4)return i.debug("solveForX: brute force solution X =",r),r}return i.debug("solveForX: no solution found in range",n,"to",o),null}(e,n,-1e4,1e4)}class Q extends A{name="TypeAnswerSolver";canSolve(e){return null!=e.textInput&&null!=e.equationContainer}solve(e){if(!e.textInput||!e.equationContainer)return this.failure("typeAnswer","missing textInput or equationContainer");this.log("starting");const t=e.equationContainer.querySelector("annotation");if(!t?.textContent)return this.failure("typeAnswer","annotation not found");const n=t.textContent;this.log("equation =",n);return this.trySolveSimplifyFraction(e.textInput,n)??this.trySolveInequality(e.textInput,n)??this.trySolveEquationWithBlank(e.textInput,n)}trySolveSimplifyFraction(e,t){if(t.includes("=")||t.includes("\\duoblank"))return null;this.log("detected SIMPLIFY FRACTION type");const n=z(t);if(!n)return this.logDebug("could not parse fraction from expression"),null;this.log("parsed fraction:",`${n.numerator}/${n.denominator}`);const o=X(n.numerator,n.denominator);this.log("simplified to:",`${o.numerator}/${o.denominator}`);const r=`${o.numerator}/${o.denominator}`;return this.typeInput(e,r),this.log("typed answer:",r),this.success({type:"simplifyFraction",original:n,simplified:o,answer:r})}trySolveInequality(e,t){const n=t.includes(">")||t.includes("<")||t.includes("\\gt")||t.includes("\\lt")||t.includes("\\ge")||t.includes("\\le"),o=t.includes("\\duoblank");if(!n||!o)return null;this.log("detected INEQUALITY with blank type");const r=function(e){let t=F(e),n=null;if(t.includes(">=")||t.includes("\\ge")?n=">=":t.includes("<=")||t.includes("\\le")?n="<=":t.includes(">")||t.includes("\\gt")?n=">":(t.includes("<")||t.includes("\\lt"))&&(n="<"),!n)return null;t=t.replace(/\\ge/g,">=").replace(/\\le/g,"<=").replace(/\\gt/g,">").replace(/\\lt/g,"<");const o=t.split(/>=|<=|>|</);if(2!==o.length)return null;const[r,i]=o,s=r?.includes("\\duoblank"),l=i?.includes("\\duoblank");if(!s&&!l)return null;const a=s?i:r;if(!a)return null;const c=a.match(/\\frac\{(\d+)\}\{(\d+)\}/);let u,d,h;if(c?.[1]&&c[2]){const e=parseInt(c[1],10);d=parseInt(c[2],10),u=e/d}else{const e=a.match(/(\d+)/);if(!e?.[1])return null;u=parseFloat(e[1]),d=1}if(s)switch(n){case">":h=Math.floor(u*d)+1;break;case">=":h=Math.ceil(u*d);break;case"<":h=Math.ceil(u*d)-1;break;case"<=":h=Math.floor(u*d);break;default:return null}else switch(n){case">":h=Math.ceil(u*d)-1;break;case">=":h=Math.floor(u*d);break;case"<":h=Math.floor(u*d)+1;break;case"<=":h=Math.ceil(u*d);break;default:return null}return h<=0&&(h=1),`${h}/${d}`}(t);return null===r?(this.logDebug("could not solve inequality"),null):(this.typeInput(e,r),this.log("typed answer:",r),this.success({type:"typeAnswer",equation:t,answer:r}))}trySolveEquationWithBlank(e,t){this.log("solving as equation with blank");const n=j(t);return null===n?this.failure("typeAnswer","could not solve equation"):(this.typeInput(e,n.toString()),this.log("typed answer:",n),this.success({type:"typeAnswer",equation:t,answer:n}))}}class Y extends A{name="SelectEquivalentFractionSolver";canSolve(e){const t=this.getHeaderText(e),n=t.includes("equivalent")||t.includes("equal")||t.includes("same"),o=null!=e.choices&&e.choices.length>0,r=null!=e.equationContainer;return n&&o&&r}solve(e){if(!e.equationContainer||!e.choices?.length)return this.failure("selectFraction","missing equationContainer or choices");this.log("starting");const t=e.equationContainer.querySelector("annotation");if(!t?.textContent)return this.failure("selectFraction","annotation not found");const n=z(t.textContent);if(!n)return this.failure("selectFraction","could not parse target fraction");this.log("target =",`${n.numerator}/${n.denominator}`,"=",n.value);let o=-1;for(let t=0;t<e.choices.length;t++){const r=e.choices[t];if(!r)continue;const i=r.querySelector("annotation");if(!i?.textContent)continue;const s=z(i.textContent);if(s&&(this.logDebug("choice",t,"=",`${s.numerator}/${s.denominator}`),W(n.numerator,n.denominator,s.numerator,s.denominator))){o=t,this.log("found equivalent at choice",t);break}}if(-1===o)return this.failure("selectFraction","no equivalent fraction found");const r=e.choices[o];return r&&(this.click(r),this.log("clicked choice",o)),this.success({type:"selectFraction",original:n,selectedChoice:o})}}class Z extends A{name="ComparisonChoiceSolver";canSolve(e){if(!e.equationContainer||!e.choices?.length)return!1;const t=e.equationContainer.querySelector("annotation");if(!t?.textContent)return!1;const n=t.textContent,o=n.includes(">")||n.includes("<")||n.includes("\\gt")||n.includes("\\lt")||n.includes("\\ge")||n.includes("\\le"),r=n.includes("\\duoblank");return o&&r}solve(e){if(!e.equationContainer||!e.choices?.length)return this.failure("comparison","missing equationContainer or choices");this.log("starting");const t=e.equationContainer.querySelector("annotation");if(!t?.textContent)return this.failure("comparison","annotation not found");const n=t.textContent;this.log("equation =",n);const o=this.detectOperator(n);if(!o)return this.failure("comparison","no comparison operator found");this.log("operator =",o);const r=this.extractLeftValue(n,o);if(null===r)return this.failure("comparison","could not evaluate left side");this.log("left value =",r);let i=-1;for(let t=0;t<e.choices.length;t++){const n=e.choices[t];if(!n)continue;const s=n.querySelector("annotation");if(!s?.textContent)continue;const l=z(s.textContent);if(!l)continue;const a=l.value;if(this.logDebug("choice",t,"=",a),this.compareValues(r,o,a)){i=t,this.log("found matching choice",t,":",r,o,a);break}}if(-1===i)return this.failure("comparison","no choice satisfies comparison");const s=e.choices[i];return s&&(this.click(s),this.log("clicked choice",i)),this.success({type:"comparison",leftValue:r,operator:o,selectedChoice:i})}detectOperator(e){return e.includes("<=")||e.includes("\\le")?"<=":e.includes(">=")||e.includes("\\ge")?">=":e.includes("<")||e.includes("\\lt")?"<":e.includes(">")||e.includes("\\gt")?">":null}extractLeftValue(e,t){const n=["<=",">=","\\le","\\ge","<",">","\\lt","\\gt"];let o=F(e);for(const e of n)if(o.includes(e)){const t=o.split(e)[0];void 0!==t&&(o=t);break}return o=R(o),G(o)}compareValues(e,t,n){switch(t){case"<":return e<n;case">":return e>n;case"<=":return e<=n;case">=":return e>=n}}}class ee extends A{name="SelectOperatorSolver";canSolve(e){if(!e.equationContainer||!e.choices?.length)return!1;const t=e.equationContainer.querySelector("annotation");if(!t?.textContent)return!1;const n=t.textContent.includes("\\duoblank"),o=e.choices.some(e=>{const t=e?.textContent?.trim()??"";return"<"===t||">"===t||"="===t||t.includes("\\lt")||t.includes("\\gt")});return n&&o}solve(e){if(!e.equationContainer||!e.choices?.length)return this.failure("selectOperator","missing equationContainer or choices");this.log("starting");const t=e.equationContainer.querySelector("annotation");if(!t?.textContent)return this.failure("selectOperator","annotation not found");const n=t.textContent;this.log("equation =",n);const o=this.extractValues(n);if(!o)return this.failure("selectOperator","could not extract values");const{leftValue:r,rightValue:i}=o;this.log("left =",r,", right =",i);const s=this.determineOperator(r,i);this.log("correct operator =",s);let l=-1;for(let t=0;t<e.choices.length;t++){const n=e.choices[t];if(!n)continue;const o=this.parseOperatorFromChoice(n);if(this.logDebug("choice",t,"=",o),o===s){l=t,this.log("found matching choice",t);break}}if(-1===l)return this.failure("selectOperator","no choice matches correct operator");const a=e.choices[l];return a&&(this.click(a),this.log("clicked choice",l)),this.success({type:"selectOperator",leftValue:r,rightValue:i,operator:s,selectedChoice:l})}extractValues(e){let t=F(e);t=t.replace(/\\duoblank\{[^}]*\}/g," BLANK "),t=t.replace(/\\[;,]/g," "),t=t.replace(/\\quad/g," "),t=t.replace(/\s+/g," ").trim();const n=t.split("BLANK");if(2!==n.length||!n[0]||!n[1])return this.logError("could not split by BLANK"),null;let o=n[0].trim(),r=n[1].trim();o=this.removeBraces(o),r=this.removeBraces(r),o=R(o),r=R(r),o=o.replace(/[{}]/g,"").trim(),r=r.replace(/[{}]/g,"").trim();const i=G(o),s=G(r);return null===i||null===s?(this.logError("could not evaluate values"),null):{leftValue:i,rightValue:s}}removeBraces(e){let t=e.trim();return t.startsWith("{")&&t.endsWith("}")&&(t=t.substring(1,t.length-1)),t}determineOperator(e,t){return Math.abs(e-t)<1e-4?"=":e<t?"<":">"}parseOperatorFromChoice(e){const t=e.textContent?.trim()??"",n=e.querySelector("annotation"),o=(n?.textContent?.trim()??"")||t;return o.includes("\\lt")||"<"===o?"<":o.includes("\\gt")||">"===o?">":"="===o||o.includes("=")?"=":null}}function te(e){if(!e)return null;const t=function(e){const t=e.match(/<span class="dark-img">([\s\S]*?)<\/span>/);if(t?.[1])return i.debug("extractPieChartFraction: using dark mode SVG"),t[1];const n=e.match(/<span class="light-img">([\s\S]*?)<\/span>/);return n?.[1]?(i.debug("extractPieChartFraction: using light mode SVG"),n[1]):e}(e),n=function(e){const t=e.match(/<path[^>]*fill="(#49C0F8|#1CB0F6)"[^>]*>/g)??[],n=e.match(/<path[^>]*fill="(#131F24|#FFFFFF)"[^>]*>/g)??[],o=t.filter(e=>e.includes("stroke=")).length,r=o+n.filter(e=>e.includes("stroke=")).length;return r>0?(i.debug("extractPieChartFraction: (method 1) colored =",o,", total =",r),{numerator:o,denominator:r,value:o/r}):null}(t);if(n)return n;const o=function(e){if(!e.includes("<circle"))return null;i.debug("extractPieChartFraction: detected circle-based pie chart");const t=e.match(/<path[^>]*stroke[^>]*>/g)??[],n=t.length;if(i.debug("extractPieChartFraction: found",n,"path elements"),0===n)return{numerator:1,denominator:1,value:1};const o=e.match(/<path[^>]*d="([^"]+)"[^>]*>/),r=o?.[1],s=t.filter(e=>e.includes("L100 100")||e.includes("L 100 100")||e.includes("100L100"));if(s.length>0){const e=s.length;if(1===e&&r){if(r.includes("198")||r.includes("2 ")||r.includes(" 2C")||r.includes(" 2V")||r.includes("V2")||r.includes("V100"))return i.debug("extractPieChartFraction: (method 2) detected 1/4 sector"),{numerator:1,denominator:4,value:.25};if(r.includes("180")||(r.match(/100/g)?.length??0)>=4)return i.debug("extractPieChartFraction: (method 2) detected 1/2 sector"),{numerator:1,denominator:2,value:.5}}return i.debug("extractPieChartFraction: (method 2) fallback - sectors =",e),{numerator:e,denominator:4,value:e/4}}return 1===n?(i.debug("extractPieChartFraction: (method 2) single path with circle - assuming 1/4"),{numerator:1,denominator:4,value:.25}):null}(t);return o||(i.debug("extractPieChartFraction: no pie sectors found"),null)}class ne extends A{name="SelectPieChartSolver";canSolve(e){if(!e.choices?.length)return!1;return e.choices.some(e=>{const t=e?.querySelector('iframe[title="Math Web Element"]');if(!t)return!1;const n=t.getAttribute("srcdoc");return n?.includes("<circle")||n?.includes('fill="#')})}solve(e){if(!e.choices?.length)return this.failure("selectPieChart","no choices found");this.log("starting");const t=this.extractTargetValue(e);if(null===t)return this.failure("selectPieChart","could not determine target value");this.log("target value =",t);let n=-1;for(let o=0;o<e.choices.length;o++){const r=e.choices[o];if(!r)continue;const i=r.querySelector('iframe[title="Math Web Element"]');if(!i)continue;const s=i.getAttribute("srcdoc");if(!s)continue;const l=te(s);if(l&&(this.logDebug("choice",o,"=",`${l.numerator}/${l.denominator}`,"=",l.value),Math.abs(l.value-t)<1e-4)){n=o,this.log("found matching choice",o);break}}if(-1===n)return this.failure("selectPieChart","no matching pie chart found");const o=e.choices[n];return o&&(this.click(o),this.log("clicked choice",n)),this.success({type:"selectPieChart",targetValue:t,selectedChoice:n})}extractTargetValue(e){if(!e.equationContainer)return null;const t=e.equationContainer.querySelector("annotation");if(!t?.textContent)return null;const n=t.textContent;this.log("equation =",n);let o=F(n);if(o=o.replace(/\\duoblank\{[^}]*\}/g,""),o=R(o),o=o.replace(/\s+/g,""),o.includes("=")){const e=o.split("=")[0];if(e)return G(e)}return G(o)}}class oe extends A{name="PieChartTextInputSolver";canSolve(e){if(!e.iframe||!e.textInput)return!1;const t=e.iframe.getAttribute("srcdoc");return!!t&&(t.includes("<circle")||t.includes('fill="#'))}solve(e){if(!e.iframe||!e.textInput)return this.failure("pieChartTextInput","missing iframe or textInput");this.log("starting");const t=e.iframe.getAttribute("srcdoc");if(!t)return this.failure("pieChartTextInput","no srcdoc in iframe");const n=te(t);if(!n)return this.failure("pieChartTextInput","could not extract fraction from pie chart");this.log("extracted fraction:",`${n.numerator}/${n.denominator}`,"=",n.value);const o=`${n.numerator}/${n.denominator}`;return this.typeInput(e.textInput,o),this.log("typed answer:",o),this.success({type:"selectFraction",original:n,answer:o})}}class re extends A{name="EquationBlankSolver";canSolve(e){if(!e.equationContainer||!e.choices?.length)return!1;const t=e.equationContainer.querySelector("annotation");if(!t?.textContent)return!1;const n=t.textContent;return n.includes("\\duoblank")&&n.includes("=")}solve(e){if(!e.equationContainer||!e.choices?.length)return this.failure("equationBlank","missing equationContainer or choices");this.log("starting");const t=e.equationContainer.querySelector("annotation");if(!t?.textContent)return this.failure("equationBlank","annotation not found");const n=t.textContent;this.log("equation =",n);const o=j(n);if(null===o)return this.failure("equationBlank","could not solve equation");this.log("solved answer =",o);const r=[],i="checkbox"===e.choices[0]?.getAttribute("role");for(let t=0;t<e.choices.length;t++){const n=e.choices[t];if(!n)continue;const s=M(n);if(null===s)continue;this.logDebug("choice",t,"=",s);let l=null;if(/[+\-*/]/.test(s)?l=G(s):(l=parseFloat(s),Number.isNaN(l)&&(l=null)),null!==l&&Math.abs(l-o)<1e-4&&(r.push(t),this.log("found matching choice at index",t),!i))break}if(0===r.length)return this.failure("equationBlank",`no matching choice for answer ${o}`);for(const t of r){const n=e.choices[t];n&&(this.click(n),this.log("clicked choice",t))}const s=r[0];return void 0===s?this.failure("equationBlank","unexpected: no matching indices"):this.success({type:"equationBlank",equation:n,answer:o,selectedChoice:s})}}class ie extends A{name="MatchPairsSolver";canSolve(e){const t=this.headerContains(e,"match","pair"),n=(e.choices?.length??0)>=4,o=e.container.querySelectorAll('[data-test="challenge-tap-token"], [data-test="-challenge-tap-token"]');return(t||o.length>=4)&&n}solve(e){this.log("starting");const t=e.container.querySelectorAll('[data-test="challenge-tap-token"], [data-test="-challenge-tap-token"]');if(this.log("found tap tokens:",t.length),t.length<2)return this.failure("matchPairs","Not enough tap tokens");const n=this.extractTokens(Array.from(t));if(this.log("active tokens:",n.length),n.length<2)return this.failure("matchPairs","Not enough active tokens");const o=this.findPairs(n);if(0===o.length)return this.logError("no matching pairs found"),this.failure("matchPairs","No matching pairs found");const r=o[0];return r?(this.log("clicking pair:",r.first.rawValue,"↔",r.second.rawValue),this.click(r.first.element),setTimeout(()=>{this.click(r.second.element)},100),this.success({type:"matchPairs",pairs:o.map(e=>({first:e.first.rawValue,second:e.second.rawValue})),clickedPair:{first:r.first.rawValue,second:r.second.rawValue}})):this.failure("matchPairs","No pair to click")}extractTokens(e){const t=[];let n=!1,o=10;for(let r=0;r<e.length;r++){const i=e[r];if(!i)continue;if("true"===i.getAttribute("aria-disabled")){this.log("token",r,"is disabled, skipping");continue}const s=i.querySelector("._27M4R");if(s){const e=s.textContent??"";this.log("token",r,"has Nearest label:",e);const l=e.match(/Nearest\s*(\d+)/i);if(l?.[1]){n=!0,o=parseInt(l[1],10);const e=this.extractRoundingToken(i,r,o);if(e){this.log("token",r,"extracted rounding:",e.rawValue),t.push(e);continue}this.log("token",r,"failed to extract rounding value")}}const l=i.querySelector('iframe[title="Math Web Element"]');if(l&&!s){const e=l.getAttribute("srcdoc");if(e?.includes("<svg")){if(N(e)){const n=V(e);if(null!==n){this.log("token",r,"extracted block diagram:",n),t.push({index:r,element:i,rawValue:`${n} blocks`,numericValue:n,isBlockDiagram:!0});continue}}const n=te(e);if(n){this.log("token",r,"extracted pie chart:",n.value),t.push({index:r,element:i,rawValue:`${n.numerator}/${n.denominator} (pie)`,numericValue:n.value,isPieChart:!0});continue}}}const a=M(i);if(a){const e=G(a),n=this.isCompoundExpression(a);this.log("token",r,"extracted KaTeX:",a,"=",e),t.push({index:r,element:i,rawValue:a,numericValue:e,isExpression:n,isPieChart:!1})}else this.log("token",r,"failed to extract any value")}return this.hasNearestRounding=n,this.roundingBase=o,t}hasNearestRounding=!1;roundingBase=10;extractRoundingToken(e,t,n){const o=e.querySelector('iframe[title="Math Web Element"]');if(o){const r=o.getAttribute("srcdoc");if(r){const o=V(r);if(null!==o)return{index:t,element:e,rawValue:`${o} blocks`,numericValue:o,isBlockDiagram:!0,isRoundingTarget:!0,roundingBase:n}}}const r=M(e);if(r){return{index:t,element:e,rawValue:r,numericValue:G(r),isBlockDiagram:!1,isRoundingTarget:!0,roundingBase:n}}return null}isCompoundExpression(e){return e.includes("+")||e.includes("*")||/\)\s*-/.test(e)||/\d\s*-\s*\(/.test(e)}findPairs(e){const t=[],n=new Set,o=e.filter(e=>e.isPieChart),r=e.filter(e=>e.isBlockDiagram&&!e.isRoundingTarget),i=e.filter(e=>e.isRoundingTarget),s=e.filter(e=>!e.isPieChart&&!e.isBlockDiagram&&!e.isRoundingTarget);return this.hasNearestRounding&&i.length>0?this.matchRounding(e,i,t,n):r.length>0&&s.length>0?this.matchBlockDiagrams(r,s,t,n):o.length>0&&s.length>0?this.matchPieCharts(o,s,t,n):this.matchExpressions(e,t,n),t}matchRounding(e,t,n,o){const r=e.filter(e=>!e.isPieChart&&!e.isBlockDiagram&&!e.isRoundingTarget);for(const e of r){if(o.has(e.index)||null===e.numericValue)continue;const r=q(e.numericValue,this.roundingBase);for(const i of t)if(!o.has(i.index)&&i.numericValue===r){n.push({first:e,second:i}),o.add(e.index),o.add(i.index),this.log("found rounding pair:",e.rawValue,"→",r);break}}}matchBlockDiagrams(e,t,n,o){for(const r of e)if(!o.has(r.index)&&null!==r.numericValue)for(const e of t)if(!o.has(e.index)&&null!==e.numericValue&&Math.abs(r.numericValue-e.numericValue)<1e-4){n.push({first:r,second:e}),o.add(r.index),o.add(e.index),this.log("found block diagram pair:",r.rawValue,"=",e.rawValue);break}}matchPieCharts(e,t,n,o){for(const r of e)if(null!==r.numericValue)for(const e of t)if(!o.has(e.index)&&null!==e.numericValue&&Math.abs(r.numericValue-e.numericValue)<1e-4){n.push({first:r,second:e}),o.add(e.index),this.log("found pie chart pair:",r.rawValue,"=",e.rawValue);break}}matchExpressions(e,t,n){const o=e.filter(e=>e.isExpression&&!e.isRoundingTarget),r=e.filter(e=>!(e.isExpression||e.isRoundingTarget||e.isPieChart||e.isBlockDiagram));if(o.length>0&&r.length>0){for(const e of o)if(null!==e.numericValue)for(const o of r)if(!n.has(o.index)&&null!==o.numericValue&&Math.abs(e.numericValue-o.numericValue)<1e-4){t.push({first:e,second:o}),n.add(o.index),this.log("found expression pair:",e.rawValue,"=",o.rawValue);break}}else this.matchFallback(e,t,n)}matchFallback(e,t,n){const o=e.filter(e=>!e.isRoundingTarget);for(let e=0;e<o.length;e++){const r=o[e];if(r&&!n.has(r.index)&&null!==r.numericValue)for(let i=e+1;i<o.length;i++){const e=o[i];if(e&&!n.has(e.index)&&null!==e.numericValue&&(Math.abs(r.numericValue-e.numericValue)<1e-4&&r.rawValue!==e.rawValue)){t.push({first:r,second:e}),n.add(r.index),n.add(e.index),this.log("found fallback pair:",r.rawValue,"=",e.rawValue);break}}}}}class se extends A{name="InteractiveSliderSolver";canSolve(e){const t=b(e.container);for(const e of t){const t=e.getAttribute("srcdoc");if(t?.includes("NumberLine"))return!0}return!1}solve(e){this.log("starting");const t=b(e.container);let n=null,o=null,r=null;if(t.length>=2){const e=x(t,"<svg");if(e){const i=e.getAttribute("srcdoc");if(i){if(N(i)){const e=V(i);null!==e&&(n=e,o=`block diagram: ${e}`,this.log("found block diagram value:",e))}if(null===n){const e=te(i);e&&null!==e.value&&(n=e.value,o=`pie chart: ${e.numerator}/${e.denominator}`,this.log("found pie chart fraction:",o))}}for(const n of t)if(n!==e){const e=n.getAttribute("srcdoc");if(e?.includes("NumberLine")){r=n;break}}}}if(null===n){const t=this.tryRoundingChallenge(e);t&&(n=t.value,o=t.equation)}if(null===n){const t=this.tryEquationChallenge(e);t&&(n=t.value,o=t.equation)}if(null===n){const t=this.tryKatexExpression(e);t&&(n=t.value,o=t.equation)}if(null===n)return this.logError("could not determine target value"),this.failure("interactiveSlider","Could not determine target value");if(r||(r=x(t,"NumberLine")),!r)return this.failure("interactiveSlider","No slider iframe found");const i=this.setSliderValue(r,n);this.log("target value =",n,", success =",i);const s={type:"interactiveSlider",success:!0,answer:n};return o&&(s.equation=o),s}tryRoundingChallenge(e){const t=this.getHeaderText(e);if(!t.includes("round")||!t.includes("nearest"))return null;const n=t.match(/nearest\s*(\d+)/);if(!n?.[1])return null;const o=parseInt(n[1],10),r=e.container.querySelectorAll("annotation");for(const e of r){let t=e.textContent?.trim()??"";t=t.replace(/\\mathbf\{([^}]+)\}/g,"$1"),t=t.replace(/\\textbf\{([^}]+)\}/g,"$1"),t=t.replace(/\\htmlClass\{[^}]*\}\{([^}]+)\}/g,"$1");const n=parseInt(t,10);if(!isNaN(n)&&n>0){return{value:q(n,o),equation:`round(${n}) to nearest ${o}`}}}return null}tryEquationChallenge(e){const t=e.container.querySelectorAll("annotation");for(const e of t){const t=e.textContent;if(t){if(t.includes("\\duoblank")){const e=j(t);if(null!==e)return{value:e,equation:t}}if(t.includes("=")&&t.includes("?")){const e=t.match(/(.+)=\s*\?/);if(e?.[1]){const n=G(e[1].replace(/\\mathbf\{([^}]+)\}/g,"$1").replace(/\s+/g,""));if(null!==n)return{value:n,equation:t}}}}}return null}tryKatexExpression(e){const t=e.container.querySelectorAll(".katex");for(const e of t){const t=M(e);if(!t)continue;const n=t.replace(/\s/g,"");if(/^[\d+\-*/×÷().]+$/.test(n)&&(t.includes("+")||t.includes("-")||t.includes("*")||t.includes("/"))){const e=G(t);if(null!==e)return{value:e,equation:t}}}return null}setSliderValue(e,t){let n=!1;try{const o=e.contentWindow;if(!o)return!1;if("function"==typeof o.getOutputVariables){const e=o.getOutputVariables();e&&"object"==typeof e&&(e.value=t,n=!0,this.log("set value via getOutputVariables"))}!n&&o.OUTPUT_VARS&&(o.OUTPUT_VARS.value=t,n=!0,this.log("set value via OUTPUT_VARS")),"function"==typeof o.postOutputVariables&&o.postOutputVariables(),o.duo?.onFirstInteraction&&o.duo.onFirstInteraction(),o.duoDynamic?.onInteraction&&o.duoDynamic.onInteraction();const r=o.mathDiagram;r&&(r.sliderInstance?.setValue?(r.sliderInstance.setValue(t),n=!0):r.slider?.setValue?(r.slider.setValue(t),n=!0):r.setValue&&(r.setValue(t),n=!0)),o.postMessage({type:"outputVariables",payload:{value:t}},"*")}catch(e){this.logError("error setting slider value:",e)}return n}}class le extends A{name="InteractiveSpinnerSolver";canSolve(e){const t=b(e.container);for(const e of t){const t=e.getAttribute("srcdoc");if(t?.includes("segments:"))return!0}return!1}solve(e){this.log("starting");const t=x(b(e.container),"segments:");if(!t)return this.failure("interactiveSpinner","No spinner iframe found");const n=(t.getAttribute("srcdoc")??"").match(/segments:\s*(\d+)/),o=n?.[1]?parseInt(n[1],10):null;if(!o)return this.failure("interactiveSpinner","Could not determine spinner segments");this.logDebug("spinner has",o,"segments");let r=null,i=null,s=null;const l=this.tryInequalityWithBlank(e,o);if(l&&(r=l.numerator,i=l.denominator,s=l.equation),null===r){const t=this.tryEquationWithFractions(e,o);t&&(r=t.numerator,i=t.denominator,s=t.equation)}if(null===r){const t=this.trySimpleFraction(e);t&&(r=t.numerator,i=t.denominator,s=t.equation)}if(null===r){const t=this.tryKatexExpression(e,o);t&&(r=t.numerator,i=t.denominator,s=t.equation)}if(null===r||null===i)return this.logError("could not extract fraction from challenge"),this.failure("interactiveSpinner","Could not extract fraction");if(o!==i){const e=r/i;r=Math.round(e*o),i=o,this.log("adjusted to",r,"/",i)}if(r<0||r>o)return this.logError("invalid numerator",r),this.failure("interactiveSpinner","Invalid numerator");const a=this.setSpinnerValue(t,r);this.log("select",r,"segments, success =",a);const c={type:"interactiveSpinner",success:!0,numerator:r,denominator:i};return s&&(c.equation=s),c}tryInequalityWithBlank(e,t){const n=e.container.querySelectorAll("annotation");for(const e of n){const n=e.textContent??"",o=n.includes(">")||n.includes("<")||n.includes("\\gt")||n.includes("\\lt"),r=n.includes("\\duoblank");if(!o||!r)continue;let i=n;for(;i.includes("\\mathbf{");)i=B(i,"\\mathbf");let s=null,l="";if(i.includes(">=")||i.includes("\\ge")?(s=">=",l=i.includes(">=")?">=":"\\ge"):i.includes("<=")||i.includes("\\le")?(s="<=",l=i.includes("<=")?"<=":"\\le"):i.includes(">")||i.includes("\\gt")?(s=">",l=i.includes(">")?">":"\\gt"):(i.includes("<")||i.includes("\\lt"))&&(s="<",l=i.includes("<")?"<":"\\lt"),!s)continue;const a=i.split(l);if(2!==a.length)continue;const c=a[0]?.trim()??"",u=a[1]?.trim()??"",d=c.includes("\\duoblank"),h=d?u:c;let f=null;const g=h.match(/\\frac\{(\d+)\}\{(\d+)\}/);if(g?.[1]&&g[2])f=parseInt(g[1],10)/parseInt(g[2],10);else{const e=h.match(/(\d+)/);e?.[1]&&(f=parseFloat(e[1]))}if(null===f)continue;let p=null;if(d)if(">"===s||">="===s)for(let e=0;e<=t;e++){const n=e/t;if(">="===s?n>=f:n>f){p=e;break}}else for(let e=t;e>=0;e--){const n=e/t;if("<="===s?n<=f:n<f){p=e;break}}else if(">"===s||">="===s)for(let e=t;e>=0;e--){const n=e/t;if(">="===s?n<=f:n<f){p=e;break}}else for(let e=0;e<=t;e++){const n=e/t;if("<="===s?n>=f:n>f){p=e;break}}if(null!==p)return{numerator:p,denominator:t,equation:n}}return null}tryEquationWithFractions(e,t){const n=e.container.querySelectorAll("annotation");for(const e of n){const n=e.textContent??"";if(!n.includes("=")||!n.includes("\\frac"))continue;let o=n;for(;o.includes("\\mathbf{");)o=B(o,"\\mathbf");const r=G(R(o.split(/=(?:\\duoblank\{[^}]*\})?/)[0]??"").replace(/\s+/g,""));if(null!==r){const e=Math.round(r*t);if(e>=0&&e<=t)return{numerator:e,denominator:t,equation:n}}}return null}trySimpleFraction(e){const t=e.container.querySelectorAll("annotation");for(const e of t){let t=e.textContent??"";for(;t.includes("\\mathbf{");)t=B(t,"\\mathbf");const n=t.match(/\\frac\{(\d+)\}\{(\d+)\}/);if(n?.[1]&&n[2])return{numerator:parseInt(n[1],10),denominator:parseInt(n[2],10),equation:e.textContent??""};const o=t.match(/(\d+)\s*\/\s*(\d+)/);if(o?.[1]&&o[2])return{numerator:parseInt(o[1],10),denominator:parseInt(o[2],10),equation:e.textContent??""}}return null}tryKatexExpression(e,t){const n=e.container.querySelectorAll(".katex");for(const e of n){const n=M(e);if(!n)continue;if(n.includes("+")&&n.includes("/")){const e=G(n.replace(/=.*$/,""));if(null!==e){const o=Math.round(e*t);if(o>=0&&o<=t)return{numerator:o,denominator:t,equation:n}}}const o=n.match(/\((\d+)\/(\d+)\)/);if(o?.[1]&&o[2])return{numerator:parseInt(o[1],10),denominator:parseInt(o[2],10),equation:n}}return null}setSpinnerValue(e,t){let n=!1;try{const o=e.contentWindow;if(!o)return!1;const r=[];for(let e=0;e<t;e++)r.push(e);if("function"==typeof o.getOutputVariables){const e=o.getOutputVariables();e&&"selected"in e&&(e.selected=r,n=!0,this.log("set selected via getOutputVariables"))}!n&&o.OUTPUT_VARIABLES&&(o.OUTPUT_VARIABLES.selected=r,n=!0,this.log("set selected via OUTPUT_VARIABLES")),"function"==typeof o.postOutputVariables&&o.postOutputVariables(),o.duo?.onFirstInteraction&&o.duo.onFirstInteraction(),o.duoDynamic?.onInteraction&&o.duoDynamic.onInteraction(),o.postMessage({type:"outputVariables",payload:{selected:r}},"*")}catch(e){this.logError("error setting spinner value:",e)}return n}}class ae extends A{name="ExpressionBuildSolver";canSolve(e){const t=b(e.container);for(const e of t){const t=e.getAttribute("srcdoc");if(t?.includes("exprBuild")||t?.includes("ExpressionBuild"))return!0}return!1}solve(e){this.log("starting");const t=this.extractTargetValue(e);if(null===t)return this.failure("expressionBuild","Could not determine target value");this.log("target value =",t);const n=b(e.container),o=x(n,"exprBuild")??x(n,"ExpressionBuild");if(!o)return this.failure("expressionBuild","No expression build iframe found");const{tokens:r,numEntries:i}=this.extractTokensAndEntries(o);if(0===r.length)return this.failure("expressionBuild","Could not find tokens");this.log("tokens =",JSON.stringify(r),", numEntries =",i);const s=this.findExpressionSolution(r,i,t);return s?(this.log("found solution - indices:",s),this.setSolution(o,s),{type:"expressionBuild",success:!0,targetValue:t,solution:s}):(this.logError("could not find solution for target",t),this.failure("expressionBuild","No solution found"))}extractTargetValue(e){const t=e.container.querySelectorAll("annotation");for(const e of t){const t=e.textContent??"";if(t.includes("\\duoblank")){const e=t.match(/(\d+)\s*=\s*\\duoblank/);if(e?.[1])return parseInt(e[1],10);const n=t.match(/\\duoblank\{\d+\}\s*=\s*(\d+)/);if(n?.[1])return parseInt(n[1],10)}}return null}extractTokensAndEntries(e){const t=[];let n=0;try{const o=e.contentWindow,r=e.contentDocument??o?.document??null;if(o?.exprBuild){const e=o.tokens??[];t.push(...e),n=o.exprBuild.entries?.length??0}if(0===t.length&&r){const e=r.querySelectorAll("script");for(const o of e){const e=o.textContent??"",r=e.match(/const\s+tokens\s*=\s*\[(.*?)\];/s);r?.[1]&&this.parseTokensString(r[1],t);const i=e.match(/entries:\s*\[(null,?\s*)+\]/);if(i){const e=i[0].match(/null/g);n=e?.length??0}}}}catch(e){this.logError("error extracting tokens:",e)}return{tokens:t,numEntries:n}}parseTokensString(e,t){const n=e.split(",").map(e=>e.trim());for(const e of n){const n=e.match(/renderNumber\((\d+)\)/);if(n?.[1])t.push(parseInt(n[1],10));else{const n=e.match(/"([^"]+)"|'([^']+)'/);n&&t.push(n[1]??n[2]??"")}}}findExpressionSolution(e,t,n){const o=[],r=[];for(let t=0;t<e.length;t++){const n=e[t];"number"==typeof n?o.push({value:n,index:t}):n&&["+","-","*","/","×","÷"].includes(n)&&r.push({value:n,index:t})}if(1===t){for(const e of o)if(e.value===n)return[e.index];return null}return 3===t?this.findThreeTokenSolution(o,r,n):5===t?this.findFiveTokenSolution(o,r,n):null}findThreeTokenSolution(e,t,n){for(const o of e)for(const r of t)for(const t of e){if(o.index===t.index)continue;if(this.evaluateOp(o.value,r.value,t.value)===n)return this.log("found:",o.value,r.value,t.value,"=",n),[o.index,r.index,t.index]}return null}findFiveTokenSolution(e,t,n){for(const o of e)for(const r of t)for(const i of e)if(i.index!==o.index)for(const s of t)if(s.index!==r.index)for(const t of e){if(t.index===o.index||t.index===i.index)continue;const e=`${o.value}${r.value}${i.value}${s.value}${t.value}`;if(G(e)===n)return this.log("found:",e,"=",n),[o.index,r.index,i.index,s.index,t.index]}return null}evaluateOp(e,t,n){switch(t){case"+":return e+n;case"-":return e-n;case"*":case"×":return e*n;case"/":case"÷":return 0!==n?e/n:null;default:return null}}setSolution(e,t){try{const n=e.contentWindow;if(!n)return;if("function"==typeof n.getOutputVariables){const e=n.getOutputVariables();e&&(e.filled_entry_indices=t,this.log("set filled_entry_indices"))}else n.OUTPUT_VARS&&(n.OUTPUT_VARS.filled_entry_indices=t);"function"==typeof n.postOutputVariables&&n.postOutputVariables(),n.duo?.onFirstInteraction&&n.duo.onFirstInteraction(),n.duoDynamic?.onInteraction&&n.duoDynamic.onInteraction()}catch(e){this.logError("error setting solution:",e)}}}class ce extends A{name="FactorTreeSolver";canSolve(e){const t=b(e.container);for(const e of t){const t=e.getAttribute("srcdoc");if(t?.includes("originalTree")&&t.includes("originalTokens"))return!0}return!1}solve(e){this.log("starting");const t=x(b(e.container),"originalTree");if(!t)return this.failure("factorTree","No factor tree iframe found");const n=t.getAttribute("srcdoc");if(!n)return this.failure("factorTree","No srcdoc found");const o=this.parseTree(n);if(!o)return this.failure("factorTree","Could not parse tree");const r=this.parseTokens(n);if(0===r.length)return this.failure("factorTree","No tokens found");this.logDebug("tokens =",JSON.stringify(r));const i=this.findBlanks(o);this.logDebug("blanks =",JSON.stringify(i));const s=this.matchTokensToBlanks(r,i);this.log("solution tokenTreeIndices =",JSON.stringify(s));return{type:"factorTree",success:this.setSolution(t,s),tokenTreeIndices:s}}parseTree(e){const t=e.match(/const\s+originalTree\s*=\s*(\{[\s\S]*?\});/);if(!t?.[1])return this.logError("could not find originalTree in srcdoc"),null;try{return JSON.parse(t[1])}catch(e){return this.logError("failed to parse originalTree:",e),null}}parseTokens(e){const t=e.match(/const\s+originalTokens\s*=\s*\[([\s\S]*?)\];/);if(!t?.[1])return this.logError("could not find originalTokens in srcdoc"),[];const n=[],o=t[1].matchAll(/renderNumber\((\d+)\)/g);for(const e of o)e[1]&&n.push(parseInt(e[1],10));return n}findBlanks(e){const t=[],n=(e,o)=>{if(e){if(null===e.value){let n=null;const r=null!==e.left?.value&&void 0!==e.left?.value?e.left.value:null,i=null!==e.right?.value&&void 0!==e.right?.value?e.right.value:null;null!==r&&null!==i&&(n=r*i,this.logDebug("blank at index",o,"expected =",r,"*",i,"=",n)),t.push({treeIndex:o,expectedValue:n})}n(e.left,2*o),n(e.right,2*o+1)}};return n(e,1),t}matchTokensToBlanks(e,t){const n=new Array(e.length).fill(0),o=new Set;for(let r=0;r<e.length;r++){const i=e[r];for(const e of t)if(e.expectedValue===i&&!o.has(e.treeIndex)){n[r]=e.treeIndex,o.add(e.treeIndex),this.logDebug("token",i,"(index",r,") -> tree position",e.treeIndex);break}}return n}setSolution(e,t){let n=!1;try{const o=e.contentWindow;if(!o)return!1;if("function"==typeof o.getOutputVariables){const e=o.getOutputVariables();e&&"tokenTreeIndices"in e&&(e.tokenTreeIndices=t,n=!0,this.log("set tokenTreeIndices via getOutputVariables"))}!n&&o.OUTPUT_VARS&&(o.OUTPUT_VARS.tokenTreeIndices=t,n=!0,this.log("set tokenTreeIndices via OUTPUT_VARS")),"function"==typeof o.postOutputVariables&&o.postOutputVariables(),o.duo?.onFirstInteraction&&o.duo.onFirstInteraction(),o.duoDynamic?.onInteraction&&o.duoDynamic.onInteraction(),o.postMessage({type:"outputVariables",payload:{tokenTreeIndices:t}},"*")}catch(e){this.logError("error setting solution:",e)}return n}}class ue extends A{name="PatternTableSolver";canSolve(e){if(!e.container.querySelector(".ihM27"))return!1;return e.container.querySelectorAll(".ihM27").length>=4}solve(e){this.log("starting");const t=e.container.querySelectorAll(".ihM27");this.log("found",t.length,"cells");const n=this.findQuestionExpression(t);if(!n)return this.failure("patternTable","Could not find question expression");this.log("question expression:",n);const o=G(n);if(this.log("calculated answer:",o),null===o)return this.failure("patternTable","Could not evaluate expression");const r=e.container.querySelectorAll(m.CHALLENGE_CHOICE),i=this.findMatchingChoice(r,o);if(-1===i)return this.failure("patternTable",`Could not find matching choice for answer ${o}`);const s=r[i];return s&&(this.log("clicking choice",i),this.click(s)),{type:"patternTable",success:!0,expression:n,answer:o,choiceIndex:i}}findQuestionExpression(e){for(let t=0;t<e.length;t+=2){const n=e[t],o=e[t+1];if(!n||!o)continue;const r=M(n),i=M(o);if(this.logDebug("row",t/2,"- expression:",r,"- result:",i),"?"===i)return r}return null}findMatchingChoice(e,t){this.log("found",e.length,"choices");for(let n=0;n<e.length;n++){const o=e[n];if(!o)continue;const r=M(o);if(this.logDebug("choice",n,"- value:",r),null===r)continue;const i=parseFloat(r);if(!isNaN(i)&&i===t)return this.log("found matching choice at index",n),n}return-1}}class de extends A{name="PieChartSelectFractionSolver";canSolve(e){if(!e.choices?.length)return!1;const t=b(e.container);for(const n of t){const t=n.getAttribute("srcdoc");if(!t?.includes("<svg"))continue;if(!e.choices.some(e=>e?.contains(n))){if(e.choices.some(e=>{const t=e?.querySelector("annotation");return t?.textContent?.includes("frac")||t?.textContent?.includes("/")}))return!0}}return!1}solve(e){if(!e.choices?.length)return this.failure("pieChartSelectFraction","no choices found");this.log("starting");const t=b(e.container);let n=null;for(const o of t){const t=o.getAttribute("srcdoc");if(!t?.includes("<svg"))continue;if(!e.choices.some(e=>e?.contains(o))){n=t;break}}if(!n)return this.failure("pieChartSelectFraction","no pie chart found");const o=te(n);if(!o)return this.failure("pieChartSelectFraction","could not extract pie chart fraction");this.log("pie chart shows",`${o.numerator}/${o.denominator}`,"=",o.value);let r=-1,i=-1;for(let t=0;t<e.choices.length;t++){const n=e.choices[t];if(!n)continue;const s=n.querySelector("annotation");if(!s?.textContent)continue;let l=s.textContent;for(;l.includes("\\mathbf{");)l=B(l,"\\mathbf");for(;l.includes("\\textbf{");)l=B(l,"\\textbf");const a=z(l);if(!a){this.logDebug("choice",t,"could not parse fraction");continue}this.log("choice",t,"=",`${a.numerator}/${a.denominator}`,"=",a.value);const c=a.numerator===o.numerator&&a.denominator===o.denominator,u=Math.abs(a.value-o.value)<1e-4;if(c){i=t,this.log("EXACT MATCH at choice",t);break}u&&-1===r&&(r=t,this.log("VALUE MATCH at choice",t))}const s=-1!==i?i:r;if(-1===s)return this.failure("pieChartSelectFraction",`no matching choice for ${o.numerator}/${o.denominator}`);const l=e.choices[s];return l&&(this.log("clicking choice",s),this.click(l)),this.success({type:"pieChartSelectFraction",pieChartNumerator:o.numerator,pieChartDenominator:o.denominator,selectedChoice:s})}}class he extends A{name="BlockDiagramChoiceSolver";canSolve(e){if(!e.choices?.length||e.choices.length<2)return!1;if(!this.headerContains(e,"show","another","way"))return!1;const t=e.container.querySelector('iframe[title="Math Web Element"]');if(!t)return!1;const n=t.getAttribute("srcdoc");return!(!n?.includes("<svg")||!n.includes("<rect"))}solve(e){if(this.log("starting"),!e.choices?.length)return this.failure("blockDiagramChoice","no choices found");const t=e.container.querySelector('iframe[title="Math Web Element"]');if(!t)return this.failure("blockDiagramChoice","no iframe found");const n=t.getAttribute("srcdoc");if(!n)return this.failure("blockDiagramChoice","no srcdoc");const o=V(n);if(null===o)return this.failure("blockDiagramChoice","could not extract block diagram value");this.log("block diagram value:",o);let r=-1,i=0;for(let t=0;t<e.choices.length;t++){const n=e.choices[t];if(!n)continue;const s=M(n);if(!s){this.log("choice",t,"no KaTeX value");continue}const l=G(s);if(null!==l){if(this.log("choice",t,"=",l),Math.abs(l-o)<1e-4){r=t,i=l,this.log("found matching choice",t,":",o,"=",l);break}}else this.log("choice",t,"could not evaluate:",s)}if(-1===r)return this.failure("blockDiagramChoice",`no choice matches block value ${o}`);const s=e.choices[r];return s&&(this.click(s),this.log("clicked choice",r)),this.success({type:"blockDiagramChoice",blockValue:o,selectedChoice:r,selectedValue:i})}}class fe extends A{name="BlockDiagramTextInputSolver";canSolve(e){if(!e.container.querySelector('input[type="text"][data-test="challenge-text-input"]'))return!1;const t=e.container.querySelector('iframe[title="Math Web Element"]');if(!t)return!1;const n=t.getAttribute("srcdoc");return!!n&&!!N(n)}solve(e){this.log("starting");const t=e.container.querySelector('iframe[title="Math Web Element"]');if(!t)return this.failure("blockDiagramTextInput","no iframe found");const n=t.getAttribute("srcdoc");if(!n)return this.failure("blockDiagramTextInput","no srcdoc");const o=V(n);if(null===o)return this.failure("blockDiagramTextInput","could not extract block diagram value");this.log("block diagram value:",o);const r=e.container.querySelector('input[type="text"][data-test="challenge-text-input"]');if(!r)return this.failure("blockDiagramTextInput","no text input found");const i=String(o);return r.value=i,r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0})),this.log("typed answer:",i),this.success({type:"blockDiagramTextInput",blockValue:o,typedAnswer:i})}}class ge{solvers=[];constructor(){this.registerDefaultSolvers()}register(e){this.solvers.push(e),i.debug("SolverRegistry: registered",e.name)}findSolver(e){for(const t of this.solvers)if(t.canSolve(e))return i.info("SolverRegistry: selected",t.name),t;return null}solve(e){const t=this.findSolver(e);if(!t)return i.warn("SolverRegistry: no solver found for challenge"),null;try{return t.solve(e)}catch(e){return i.error("SolverRegistry: solver error",e),null}}registerDefaultSolvers(){this.register(new se),this.register(new le),this.register(new ae),this.register(new ce),this.register(new ie),this.register(new ue),this.register(new he),this.register(new fe),this.register(new P),this.register(new Y),this.register(new Z),this.register(new ee),this.register(new oe),this.register(new de),this.register(new ne),this.register(new re),this.register(new Q)}getSolvers(){return[...this.solvers]}}let pe=null;function me(){return pe||(pe=new ge),pe}var be=Object.freeze({__proto__:null,SolverRegistry:ge,getSolverRegistry:me});const xe={delayBetweenActions:t.delays.betweenActions,delayAfterSolve:t.delays.afterSolve,stopOnError:!0};class ve{isRunning=!1;config;solvedCount=0;errorCount=0;constructor(e={}){this.config={...xe,...e}}async start(){this.isRunning?i.warn("AutoRunner: already running"):(i.info("AutoRunner: starting"),this.isRunning=!0,this.solvedCount=0,this.errorCount=0,await this.runLoop())}stop(){i.info("AutoRunner: stopping"),this.isRunning=!1}getStatus(){return{isRunning:this.isRunning,solved:this.solvedCount,errors:this.errorCount}}async runLoop(){let e=0;for(;this.isRunning;)try{if(k()){i.info("AutoRunner: lesson complete, looking for next...");if(g())e=0;else if(e++,i.warn(`AutoRunner: cannot click continue (attempt ${e}/5)`),e>=5){i.error("AutoRunner: stuck on result screen, stopping"),this.stop();break}await p(1e3);continue}if(C()){i.info("AutoRunner: on home page, starting next lesson...");if(!w()){i.info("AutoRunner: no more lessons available, course complete!"),this.stop();break}e=0,await p(2e3);continue}if(S()){if(i.warn("AutoRunner: incorrect answer detected"),this.config.stopOnError){this.stop();break}if(g())e=0;else if(e++,e>=5){i.error("AutoRunner: stuck on incorrect screen, stopping"),this.stop();break}await p(this.config.delayBetweenActions);continue}e=0;await this.solveOne()?(this.solvedCount++,await p(this.config.delayAfterSolve),g(),await p(this.config.delayBetweenActions)):await p(this.config.delayBetweenActions)}catch(e){if(i.error("AutoRunner: error in loop",e),this.errorCount++,this.config.stopOnError){this.stop();break}await p(this.config.delayBetweenActions)}i.info("AutoRunner: stopped. Solved:",this.solvedCount,"Errors:",this.errorCount)}async solveOne(){const e=v();if(!e)return i.debug("AutoRunner: no challenge detected"),!1;const t=me().solve(e);return t?.success?(i.info("AutoRunner: solved with",t.type),!0):(i.warn("AutoRunner: failed to solve"),!1)}}let ye=null;function ke(){return ye||(ye=new ve),ye}class Se{container=null;statusElement=null;show(){this.container||(this.container=document.createElement("div"),this.container.id="autoduo-control-panel",this.container.innerHTML=`\n            <div style="\n                position: fixed;\n                top: 10px;\n                right: 10px;\n                background: rgba(0, 0, 0, 0.9);\n                border: 1px solid #333;\n                border-radius: 8px;\n                padding: 12px 16px;\n                font-family: -apple-system, BlinkMacSystemFont, sans-serif;\n                font-size: 13px;\n                color: #fff;\n                z-index: 99999;\n            ">\n                <div style="\n                    display: flex;\n                    align-items: center;\n                    gap: 12px;\n                    margin-bottom: 8px;\n                ">\n                    <span style="font-weight: bold; color: #58cc02;">\n                        AutoDuo ${t.version}\n                    </span>\n                    <span id="autoduo-status" style="\n                        padding: 2px 8px;\n                        border-radius: 4px;\n                        font-size: 11px;\n                        background: #333;\n                    ">Stopped</span>\n                </div>\n                <div style="display: flex; gap: 8px;">\n                    <button id="autoduo-start" style="\n                        padding: 6px 16px;\n                        border: none;\n                        border-radius: 4px;\n                        background: #58cc02;\n                        color: #fff;\n                        font-weight: bold;\n                        cursor: pointer;\n                    ">Start</button>\n                    <button id="autoduo-stop" style="\n                        padding: 6px 16px;\n                        border: none;\n                        border-radius: 4px;\n                        background: #dc3545;\n                        color: #fff;\n                        font-weight: bold;\n                        cursor: pointer;\n                    ">Stop</button>\n                    <button id="autoduo-solve-one" style="\n                        padding: 6px 16px;\n                        border: none;\n                        border-radius: 4px;\n                        background: #0d6efd;\n                        color: #fff;\n                        font-weight: bold;\n                        cursor: pointer;\n                    ">Solve 1</button>\n                </div>\n            </div>\n        `,document.body.appendChild(this.container),this.statusElement=document.getElementById("autoduo-status"),this.bindEvents())}hide(){this.container&&(this.container.remove(),this.container=null,this.statusElement=null)}updateStatus(e,t="#333"){this.statusElement&&(this.statusElement.textContent=e,this.statusElement.style.background=t)}bindEvents(){const e=document.getElementById("autoduo-start"),t=document.getElementById("autoduo-stop"),n=document.getElementById("autoduo-solve-one");e?.addEventListener("click",()=>this.handleStart()),t?.addEventListener("click",()=>this.handleStop()),n?.addEventListener("click",()=>this.handleSolveOne())}handleStart(){const e=ke(),t=h();this.updateStatus("Running","#28a745"),t.log("AutoRunner started"),e.start().then(()=>{const n=e.getStatus();this.updateStatus("Stopped","#333"),t.log(`Finished. Solved: ${n.solved}, Errors: ${n.errors}`)})}handleStop(){const e=ke(),t=h();e.stop(),this.updateStatus("Stopped","#333"),t.log("AutoRunner stopped")}handleSolveOne(){const e=h();Promise.resolve().then(function(){return T}).then(({detectChallenge:t})=>{Promise.resolve().then(function(){return be}).then(({getSolverRegistry:n})=>{const o=t();if(!o)return void e.log("No challenge detected","warn");const r=n().solve(o);r?.success?e.log(`Solved: ${r.type}`,"info"):e.log("Failed to solve","error")})})}}let Ce=null;function Ee(){return Ce||(Ce=new Se),Ce}function we(e){return"number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e)}const Te=1e4,Ae=100;var qe=Object.freeze({__proto__:null,SELECTORS:m,click:f,clickContinueButton:g,delay:p,findAllIframes:b,findIframeByContent:x,pressEnter:function(){const e=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,which:13,bubbles:!0});document.dispatchEvent(e)},typeInput:function(e,t){const n=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value")?.set;n?n.call(e,t):e.value=t;const o=new Event("input",{bubbles:!0});e.dispatchEvent(o)},waitForAnyElement:function(e,t={}){const{timeout:n=Te,interval:o=Ae}=t;return new Promise(t=>{const r=Date.now(),i=()=>{for(const n of e){const e=document.querySelector(n);if(e)return void t({element:e,selector:n})}Date.now()-r>n?t(null):setTimeout(i,o)};i()})},waitForElement:function(e,t={},n=document){const{timeout:o=Te,interval:r=Ae}=t;return new Promise(t=>{const i=Date.now(),s=()=>{const l=n.querySelector(e);l?t(l):Date.now()-i>o?t(null):setTimeout(s,r)};s()})},waitForElements:function(e,t=1,n={},o=document){const{timeout:r=Te,interval:i=Ae}=n;return new Promise(n=>{const s=Date.now(),l=()=>{const a=o.querySelectorAll(e);a.length>=t||Date.now()-s>r?n(Array.from(a)):setTimeout(l,i)};l()})},waitForIframeContent:function(e,t={}){const{timeout:n=Te,interval:o=Ae}=t;return new Promise(t=>{const r=Date.now(),i=()=>{try{const n=e.getAttribute("srcdoc");if(n&&n.length>0)return void t(!0)}catch{}Date.now()-r>n?t(!1):setTimeout(i,o)};i()})}});function Ie(){const e=h(),n=Ee();e.show(),n.show(),i.setLogPanel(e),i.info(`AutoDuo ${t.version} ready`),i.info('Click "Solve 1" to solve current challenge'),i.info('Click "Start" to auto-solve all challenges')}return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Ie):Ie(),e.AutoRunner=ve,e.BaseSolver=A,e.BlockDiagramChoiceSolver=he,e.BlockDiagramTextInputSolver=fe,e.CONFIG=t,e.ComparisonChoiceSolver=Z,e.ControlPanel=Se,e.EquationBlankSolver=re,e.ExpressionBuildSolver=ae,e.FactorTreeSolver=ce,e.InteractiveSliderSolver=se,e.InteractiveSpinnerSolver=le,e.LOG=s,e.LOG_DEBUG=l,e.LOG_ERROR=c,e.LOG_WARN=a,e.LogPanel=u,e.MatchPairsSolver=ie,e.PatternTableSolver=ue,e.PieChartSelectFractionSolver=de,e.PieChartTextInputSolver=oe,e.RoundToNearestSolver=P,e.SelectEquivalentFractionSolver=Y,e.SelectOperatorSolver=ee,e.SelectPieChartSolver=ne,e.SolverRegistry=ge,e.TypeAnswerSolver=Q,e.addFractions=U,e.areFractionsEqual=W,e.ceilToNearest=function(e,t){if(t<=0)throw new Error("Base must be positive");return Math.ceil(e/t)*t},e.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},e.cleanAnnotationText=D,e.cleanLatexForEval=L,e.cleanLatexWrappers=F,e.clickNextLesson=w,e.compareFractions=H,e.convertLatexFractions=R,e.convertLatexOperators=O,e.delay=function(e){return new Promise(t=>setTimeout(t,e))},e.detectChallenge=v,e.divideFractions=function(e,t,n,o){if(0===n)throw new Error("Cannot divide by zero");return K(e,t,o,n)},e.dom=qe,e.evaluateMathExpression=G,e.extractAnnotationText=function(e){const t=e.querySelector("annotation");return t?.textContent?.trim()??null},e.extractBlockDiagramValue=V,e.extractKatexNumber=function(e){const t=M(e);if(null===t)return null;const n=parseInt(t,10);if(!Number.isNaN(n)&&String(n)===t)return n;const o=parseFloat(t);return Number.isNaN(o)?null:o},e.extractKatexValue=M,e.extractLatexContent=B,e.extractPieChartFraction=te,e.extractRoundingBase=I,e.floorToNearest=function(e,t){if(t<=0)throw new Error("Base must be positive");return Math.floor(e/t)*t},e.gcd=$,e.getAutoRunner=ke,e.getControlPanel=Ee,e.getLogPanel=h,e.getSolverRegistry=me,e.hasNextLesson=E,e.isBlockDiagram=N,e.isDigitsOnly=function(e){return/^\d+$/.test(e)},e.isFractionString=function(e){return/^\d+\s*\/\s*\d+$/.test(e.trim())||/\\frac\{\d+\}\{\d+\}/.test(e)},e.isIncorrect=S,e.isNumber=we,e.isOnHomePage=C,e.isOnResultScreen=k,e.isPieChart=function(e){if(!e)return!1;const t=/#(?:49C0F8|1CB0F6)/i.test(e),n=/<circle/i.test(e),o=/<path[^>]*stroke[^>]*>/i.test(e);return t&&o||n},e.isValidMathExpression=function(e){const t=e.replace(/\s+/g,"");return/^[\d+\-*/().]+$/.test(t)&&t.length>0},e.lcm=_,e.logger=i,e.multiplyFractions=K,e.normalizeWhitespace=function(e){return e.replace(/\s+/g," ").trim()},e.parseFractionExpression=z,e.parseSimpleFraction=function(e){const t=e.trim().match(/^(-?\d+)\s*\/\s*(-?\d+)$/);if(!t?.[1]||!t[2])return null;const n=parseInt(t[1],10),o=parseInt(t[2],10);return Number.isNaN(n)||Number.isNaN(o)||0===o?null:{numerator:n,denominator:o}},e.roundToNearest=q,e.safeParseFloat=function(e){const t=parseFloat(e);return we(t)?t:null},e.safeParseInt=function(e){const t=parseInt(e,10);return we(t)?t:null},e.setLogPanel=o,e.simplifyFraction=X,e.simplifyFractionWithValue=function(e,t){const n=X(e,t);return{...n,value:n.numerator/n.denominator}},e.subtractFractions=function(e,t,n,o){return U(e,t,-n,o)},e}({});
